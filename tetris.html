<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Tetris BabylonJS</title>
        <script src="js/babylon.js"></script>
        <style>
            html,body, #canvas{
                width:100%;
                height:100%;
                padding:0;
                margin:0;
                overflow:hidden;
            }
        </style>
    </head>

    <body>
        <canvas id="canvas"></canvas>
        <script>
            var canvas = document.getElementById("canvas");
            var engine = new BABYLON.Engine(canvas,true);
            var Scene = new BABYLON.Scene(engine);

            var Camera = new BABYLON.ArcRotateCamera("Camera",0,0,20, new BABYLON.Vector3(0,0,0), Scene);
            
            BABYLON.SceneLoader.ImportMeshAsync(["T","Z","S","O","L","I","J"], "blocks/", "TetrisBlocks.babylon",Scene).then((result) =>{
                const T = Scene.getMeshByName("T");
                const Z = Scene.getMeshByName("Z");
                const S = Scene.getMeshByName("S");
                const O = Scene.getMeshByName("O");
                const L = Scene.getMeshByName("L");
                const I = Scene.getMeshByName("I");
                const J = Scene.getMeshByName("J");
                T.position.x = -6;
                T.position.z = 0;
                Z.position.x = -6;
                Z.position.z = 0;
                S.position.x = -6;
                S.position.z = 0;
                O.position.x = -6;
                O.position.z = 0;
                L.position.x = -6;
                L.position.z = 0;
                I.position.x = -6;
                I.position.z = 0;
                J.position.x = -6;
                J.position.z = 0;

                engine.runRenderLoop(function(){
                S.position.x += 0.1;
                Z.position.x += 0.1;
                T.position.x += 0.1;
                J.position.x += 0.1;
                I.position.x += 0.1;
                O.position.x += 0.1;
                L.position.x += 0.1;

                T.isVisible = false;
                S.isVisible = false;
                Z.isVisible = false;
                J.isVisible = false;
                I.isVisible = false;
                O.isVisible = false;
                L.isVisible = false;

                
                setTimeout(function(){T.isVisible = true;},10);
                /*for (var index = 0; index < 1; index++) {
                    var newInstance = T.createInstance("i" + index);
                }*/
            });
            }); //Name of the model loads one model

            var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), Scene);
            light.specular = new BABYLON.Color3(0,0,0);
            // Default intensity is 1. Let's dim the light a small amount
            light.intensity = 0.7;

            var points = 0;
            var gravity = 0.1;
            var ground = BABYLON.Mesh.CreateBox("ground", 50, Scene);
            ground.position.y = -10;
            ground.scaling.y = 0.1;

            var ground1 = BABYLON.Mesh.CreateBox("ground1", 20, Scene);
            ground1.position.x= 20;
            
            
            /*var box = BABYLON.Mesh.CreateBox("Box", 1, Scene);
            box.position.x = -6;*/
            Scene.activeCamera.attachControl(canvas);

            var material = new BABYLON.StandardMaterial(Scene);
            material.alpha = 1;
            material.diffuseColor = new BABYLON.Color3(0,0,0);
            ground1.material = material;


            engine.runRenderLoop(function(){
                Scene.render();
            });


            window.addEventListener("resize", function(){
                engine.resize();
                T,L,J,O,I,Z,S.position.z -= gravity;
            });
        </script>
    </body>


</html>